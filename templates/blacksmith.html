<!DOCTYPE html>
<html>
<head>
    <title>Lawyer's Quest</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='game-style.css') }}">


</head>
<body>
  <script>
document.addEventListener('DOMContentLoaded', function () {
  const itemData = {{ item_info | tojson }};
  const teamGold = {{ team.gold }};
  const itemSelect = document.getElementById('item');
  const bitcoinInput = document.getElementById('bitcoin');

  function updateRepairLimit() {
    const selectedId = parseInt(itemSelect.value);
    const selectedItem = itemData.find(i => i.id === selectedId);
    if (!selectedItem) return;

    const usesLeft = selectedItem.max_uses - selectedItem.uses_remaining;
    const maxSpendable = Math.min(usesLeft, teamGold);

    bitcoinInput.max = maxSpendable;
    bitcoinInput.placeholder = `Up to ${maxSpendable} gold`;
    bitcoinInput.value = "";
  }

  itemSelect.addEventListener('change', updateRepairLimit);
  updateRepairLimit();  // Run once on load
});
</script>

<h2>ðŸ”¨ Roaming Blacksmith ðŸ”¨</h2>

<table>
  <tr>
    <td><img src="/static/blacksmith.jpg" width=150 height=150>
    </td>
    <td><p>You encounter a Roaming Blacksmith that can repair an item in your inventory. You have <b>{{ team.gold }}Â â‚¿.</b> Which item will you repair?</p>
    </td>
  </tr>
  <tr>
    <td colspan="2">
<form method="post">
  <label for="item">Item:</label>
  <select name="item_id" id="item">
    {% for item in item_info %}
    <option value="{{ item.id }}">
      {{ item.name }} ({{ item.uses_remaining }}/ {{item.max_uses}} uses left)
    </option>
  {% endfor %}

</select>


  <label for="bitcoin">â‚¿ to spend (1â‚¿ = 1 use):</label>
  <input type="number" name="bitcoin" id="bitcoin" min="1" max="" style="width: 200px;" placeholder="Select an item first">

  <button type="submit">Repair</button>
</form>
</td>
</tr>
<tr><td colspan="2">
<p><a href="{{ url_for('map_view') }}">Decline and move on</a></p>
</td></tr>
</table>
<footer style="margin-top: 2em; font-size: 0.9em; color: #666;">
  <p>
    <a href="{{ url_for('terms') }}">Privacy & Terms of Use</a> |
    <a href="{{ url_for('getting_started') }}">Getting Started</a> |
    <a href="https://youtu.be/DTIb4VuoziA">Video Walkthrough</a> |
    <a href="{{ url_for('logout') }}">Log Out</a> |
    Â© 2025, Tim Faith <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank">CC BY-SA 4.0</a> |
    ver 0.3
  </p>
</footer>
</body>
</html>
